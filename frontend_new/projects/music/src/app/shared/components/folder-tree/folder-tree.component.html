<ng-container *ngFor="let folder of (fileSystemSlice?.folders || [])">
  <ng-container *ngIf="search || (folder | isFolderOpened:fullFileSystem:(openedFolder$ | async)); else closedFolder">
    <div class="folder">
      <img [ngSrc]="'assets/icons/folder-opened.png'" [height]="14" [width]="16" alt="folder"
           (click)="openFolder(folder, 'folder')">
      <ng-container *ngTemplateOutlet="folderName; context: {folder: folder}"></ng-container>
    </div>
    <app-folder-tree [fullFileSystem]="fileSystemSlice" [fileSystemSlice]="folder | getInnerFileSystem | filterFolderTree:search"
                     [itemCategory]="itemCategory" [search]="search">
    </app-folder-tree>
  </ng-container>

  <ng-template #closedFolder>
    <div class="folder">
      <img [ngSrc]="'assets/icons/folder-closed.png'" [height]="14" [width]="16" alt="folder"
           (click)="openFolder(folder, 'folder')">
      <ng-container *ngTemplateOutlet="folderName; context: {folder: folder}"></ng-container>
    </div>
  </ng-template>
</ng-container>

<ng-template #folderName let-folder="folder">
  <span [ngClass]="{'active': (currentItem$ | async)?.id === folder.id && (currentItem$ | async)?.category === 'folder'}"
        (click)="select(folder.id, 'folder')">
    {{folder.name}}
  </span>
</ng-template>

<ng-container *ngFor="let item of (fileSystemSlice?.items || [])">
  <ng-container *ngIf="!item.playlists; else program">
    <div class="playlist-container"
         [ngClass]="{'active': (currentItem$ | async)?.id === item.id && (currentItem$ | async)?.category === item.type}">
      <ng-container *ngFor="let tag of item.prefix | getPrefixList">
        <div class="prefix" [matTooltip]="playlistPrefixList[tag]">{{tag}}</div>
      </ng-container>
      <span class="playlist" (click)="select(item.id, 'playlist')">{{item.name}}</span>
      <span class="amount">{{item.id | getPlaylistSoundsAmount | async}}</span>
    </div>
  </ng-container>

  <ng-template #program>

    <ng-container *ngIf="search || (item | isFolderOpened:fullFileSystem:(openedFolder$ | async)); else closedProgram">
      <div class="playlist-container"
           [ngClass]="{'active': (currentItem$ | async)?.id === item.id && (currentItem$ | async)?.category === item.type}">
        <img [ngSrc]="'assets/icons/folder-opened.png'" [height]="14" [width]="16" alt="program"
             (click)="openFolder(item, 'program')">
        <ng-container *ngFor="let tag of item.prefix | getPrefixList">
          <div class="prefix" [matTooltip]="playlistPrefixList[tag]">{{tag}}</div>
        </ng-container>
        <span class="playlist" (click)="select(item.id, 'program')">{{item.name}}</span>
        <!--<span class="amount">{{item.id | getPlaylistSoundsAmount | async}}</span>-->
      </div>
      <div *ngFor="let playlistData of item.playlists" class="program-playlists">
        <div *ngIf="(playlistData.playlist | getPlaylistById | async) as playlist"
             class="playlist-container"
             [ngClass]="{'active': (currentItem$ | async)?.id === playlist.id && (currentItem$ | async)?.category === 'playlist'}">
          <ng-container *ngFor="let tag of playlist.prefix | getPrefixList">
            <div class="prefix" [matTooltip]="playlistPrefixList[tag]">{{tag}}</div>
          </ng-container>
          <span class="playlist" (click)="selectProgramPlaylist(item.id, playlist.id)">{{playlist.name}}</span>
          <!--<span class="amount">{{playlist.id | getPlaylistSoundsAmount | async}}</span>-->
        </div>
      </div>
    </ng-container>

    <ng-template #closedProgram>
      <div class="playlist-container"
           [ngClass]="{'active': (currentItem$ | async)?.id === item.id && (currentItem$ | async)?.category === 'program'}">
        <img [ngSrc]="'assets/icons/folder-closed.png'" [height]="14" [width]="16" alt="program"
             (click)="openFolder(item, 'program')">
        <ng-container *ngFor="let tag of item.prefix | getPrefixList">
          <div class="prefix" [matTooltip]="playlistPrefixList[tag]">{{tag}}</div>
        </ng-container>
        <span class="playlist" (click)="select(item.id, 'program')">{{item.name}}</span>
        <!--<span class="amount">{{item.id | getPlaylistSoundsAmount | async}}</span>-->
      </div>
    </ng-template>
  </ng-template>
</ng-container>
