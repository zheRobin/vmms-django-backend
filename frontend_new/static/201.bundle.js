(self.webpackChunkvmms=self.webpackChunkvmms||[]).push([[201],{6700:(e,t,i)=>{var r={"./af":2786,"./af.js":2786,"./ar":867,"./ar-dz":4130,"./ar-dz.js":4130,"./ar-kw":6135,"./ar-kw.js":6135,"./ar-ly":6440,"./ar-ly.js":6440,"./ar-ma":7702,"./ar-ma.js":7702,"./ar-sa":6040,"./ar-sa.js":6040,"./ar-tn":7100,"./ar-tn.js":7100,"./ar.js":867,"./az":1083,"./az.js":1083,"./be":9808,"./be.js":9808,"./bg":8338,"./bg.js":8338,"./bm":7438,"./bm.js":7438,"./bn":8905,"./bn-bd":6225,"./bn-bd.js":6225,"./bn.js":8905,"./bo":1560,"./bo.js":1560,"./br":1278,"./br.js":1278,"./bs":622,"./bs.js":622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":877,"./cv.js":877,"./cy":7373,"./cy.js":7373,"./da":4780,"./da.js":4780,"./de":9740,"./de-at":217,"./de-at.js":217,"./de-ch":894,"./de-ch.js":894,"./de.js":9740,"./dv":5300,"./dv.js":5300,"./el":837,"./el.js":837,"./en-au":8348,"./en-au.js":8348,"./en-ca":7925,"./en-ca.js":7925,"./en-gb":2243,"./en-gb.js":2243,"./en-ie":6436,"./en-ie.js":6436,"./en-il":7207,"./en-il.js":7207,"./en-in":4175,"./en-in.js":4175,"./en-nz":6319,"./en-nz.js":6319,"./en-sg":1662,"./en-sg.js":1662,"./eo":2915,"./eo.js":2915,"./es":5655,"./es-do":5251,"./es-do.js":5251,"./es-mx":6112,"./es-mx.js":6112,"./es-us":1146,"./es-us.js":1146,"./es.js":5655,"./et":5603,"./et.js":5603,"./eu":7763,"./eu.js":7763,"./fa":6959,"./fa.js":6959,"./fi":1897,"./fi.js":1897,"./fil":2549,"./fil.js":2549,"./fo":4694,"./fo.js":4694,"./fr":4470,"./fr-ca":3049,"./fr-ca.js":3049,"./fr-ch":2330,"./fr-ch.js":2330,"./fr.js":4470,"./fy":5044,"./fy.js":5044,"./ga":9295,"./ga.js":9295,"./gd":2101,"./gd.js":2101,"./gl":8794,"./gl.js":8794,"./gom-deva":7884,"./gom-deva.js":7884,"./gom-latn":3168,"./gom-latn.js":3168,"./gu":5349,"./gu.js":5349,"./he":4206,"./he.js":4206,"./hi":94,"./hi.js":94,"./hr":316,"./hr.js":316,"./hu":2138,"./hu.js":2138,"./hy-am":1423,"./hy-am.js":1423,"./id":9218,"./id.js":9218,"./is":135,"./is.js":135,"./it":626,"./it-ch":150,"./it-ch.js":150,"./it.js":626,"./ja":9183,"./ja.js":9183,"./jv":4286,"./jv.js":4286,"./ka":2105,"./ka.js":2105,"./kk":7772,"./kk.js":7772,"./km":8758,"./km.js":8758,"./kn":9282,"./kn.js":9282,"./ko":3730,"./ko.js":3730,"./ku":1408,"./ku.js":1408,"./ky":3291,"./ky.js":3291,"./lb":6841,"./lb.js":6841,"./lo":5466,"./lo.js":5466,"./lt":7010,"./lt.js":7010,"./lv":7595,"./lv.js":7595,"./me":9861,"./me.js":9861,"./mi":5493,"./mi.js":5493,"./mk":5966,"./mk.js":5966,"./ml":7341,"./ml.js":7341,"./mn":5115,"./mn.js":5115,"./mr":370,"./mr.js":370,"./ms":9847,"./ms-my":1237,"./ms-my.js":1237,"./ms.js":9847,"./mt":2126,"./mt.js":2126,"./my":6165,"./my.js":6165,"./nb":4593,"./nb.js":4593,"./ne":6744,"./ne.js":6744,"./nl":3901,"./nl-be":9814,"./nl-be.js":9814,"./nl.js":3901,"./nn":3877,"./nn.js":3877,"./oc-lnc":2135,"./oc-lnc.js":2135,"./pa-in":5858,"./pa-in.js":5858,"./pl":4495,"./pl.js":4495,"./pt":9520,"./pt-br":7971,"./pt-br.js":7971,"./pt.js":9520,"./ro":6459,"./ro.js":6459,"./ru":1793,"./ru.js":1793,"./sd":950,"./sd.js":950,"./se":490,"./se.js":490,"./si":124,"./si.js":124,"./sk":4249,"./sk.js":4249,"./sl":4985,"./sl.js":4985,"./sq":1104,"./sq.js":1104,"./sr":9131,"./sr-cyrl":9915,"./sr-cyrl.js":9915,"./sr.js":9131,"./ss":5893,"./ss.js":5893,"./sv":8760,"./sv.js":8760,"./sw":1172,"./sw.js":1172,"./ta":7333,"./ta.js":7333,"./te":3110,"./te.js":3110,"./tet":2095,"./tet.js":2095,"./tg":7321,"./tg.js":7321,"./th":9041,"./th.js":9041,"./tk":9005,"./tk.js":9005,"./tl-ph":5768,"./tl-ph.js":5768,"./tlh":9444,"./tlh.js":9444,"./tr":2397,"./tr.js":2397,"./tzl":8254,"./tzl.js":8254,"./tzm":1106,"./tzm-latn":699,"./tzm-latn.js":699,"./tzm.js":1106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":7691,"./uk.js":7691,"./ur":3795,"./ur.js":3795,"./uz":6791,"./uz-latn":588,"./uz-latn.js":588,"./uz.js":6791,"./vi":5666,"./vi.js":5666,"./x-pseudo":4378,"./x-pseudo.js":4378,"./yo":5805,"./yo.js":5805,"./zh-cn":3839,"./zh-cn.js":3839,"./zh-hk":5726,"./zh-hk.js":5726,"./zh-mo":9807,"./zh-mo.js":9807,"./zh-tw":4152,"./zh-tw.js":4152};function s(e){var t=n(e);return i(t)}function n(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=n,e.exports=s,s.id=6700},7905:(e,t,i)=>{"use strict";i.d(t,{e:()=>c});var r=i(7582),s=i(421),n=i(6391),o=i(2006),l=i(5607),a=i(4831);let c=class{constructor(){this.httpClient=(0,s.inject)(n.eN),this.tokenService=(0,s.inject)(a.Br),this.globalService=(0,s.inject)(a.Uh),this.router=(0,s.inject)(l.F0)}login(e,t){return this.httpClient.post("/obtain-token/",{host:"management",username:e,password:t}).pipe((0,o.b)((e=>{this.tokenService.setToken(e?.token),this.globalService.setCurrentUser(e?.user),this.router.navigateByUrl("/")})))}logout(){return this.httpClient.get("/logout/").pipe((0,o.b)((()=>{this.tokenService.clearToken(),this.globalService.setCurrentUser({}),this.router.navigateByUrl("/auth")})))}};c=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],c)},9205:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PagesModule:()=>Ue});var r=i(7582),s=i(421),n=i(1196),o=i(7905),l=i(2006),a=i(4831),c=i(3273);let h=class{constructor(){this.authService=(0,s.inject)(o.e),this.globalService=(0,s.inject)(a.Uh),this.navItemList=[{name:"Clients",route:"clients",routerLink:!0},{name:"Users",route:"users",routerLink:!0},{name:"Schedule",route:"schedules",routerLink:!0},{name:"Master Schedule",route:"master-schedules",routerLink:!0},{name:"Group Schedule",route:"client-groups",routerLink:!0},{name:"Player Versions",route:"player-versions",routerLink:!0},{name:"Program Preview Links",route:"link-previews",routerLink:!0},{name:"Music",route:c.N.musicUrl,routerLink:!1},{name:"Video",route:c.N.videoUrl,routerLink:!1},{name:"Promotion",route:c.N.promotionUrl,routerLink:!1},{name:"Import",route:c.N.importUrl,routerLink:!1}]}ngOnInit(){this.currentUser$=this.globalService.getCurrentUser().pipe((0,l.b)((e=>{"Users"===e.group&&(this.navItemList=this.navItemList.filter((e=>"Users"!==e.name&&"Player Versions"!==e.name)))})))}logout(){this.authService.logout().subscribe()}};h=(0,r.gn)([(0,s.Component)({selector:"app-page-layout",templateUrl:"./page-layout.component.html",styleUrls:["./page-layout.component.scss"]})],h);let p=class{};p=(0,r.gn)([(0,s.Component)({selector:"app-dashboard",templateUrl:"./dashboard.component.html",styleUrls:["./dashboard.component.scss"]})],p);var d=i(5607),u=i(7434);let v=class{transform(e,t,i){if(!i)return!1;if(e.id===i.id&&e.type===i.type)return!0;const r=t?.folders.find((t=>t.id===e.id));return!!this.findItem(r?.folders||[],i)}findItem(e,t){if(!e?.length)return null;const i=e?.find((e=>e?.id===t?.id&&e?.type===t?.type));return i||this.findItem(e?.map((e=>e?.folders||[])).filter((e=>e.length)).flat()||[],t)}};v=(0,r.gn)([(0,s.Pipe)({name:"isFolderOpened"})],v);let g=class{transform(e){return{folders:e.folders||[],items:e.clients||[]}}};g=(0,r.gn)([(0,s.Pipe)({name:"getInnerFileSystem"})],g);var m=i(4890);let b=class{constructor(){this.dialogRef=(0,s.inject)(m.so),this.data=(0,s.inject)(m.WI)}confirm(){this.dialogRef.close(!0)}};b=(0,r.gn)([(0,s.Component)({selector:"app-confirmation-dialog",templateUrl:"./confirmation-dialog.component.html",styleUrls:["./confirmation-dialog.component.scss"]})],b);let C=class{transform(e,t=""){return{folders:e?.folders.filter((e=>this.search(e,t)))||[],items:e?.items.filter((e=>this.search(e,t)))||[]}}compare(e,t){return e?.toLowerCase().includes(t.toLowerCase())}search(e,t){return!!e&&(this.compare(e?.name,t)||e?.folders?.filter((e=>this.search(e,t)))?.length||e?.clients?.filter((e=>this.search(e,t)))?.length)}};C=(0,r.gn)([(0,s.Pipe)({name:"filterFolderTree"})],C);const y={"ðŸ‡©":"Dynamic","ðŸ‡¸":"Static","ðŸŽµ":"All year","â„ï¸":"Winter","â˜€ï¸":"Summer","ðŸŽ„":"Christmas"};var f=i(8515),S=i(6391),j=i(6515);let w=class{constructor(){this.helperService=(0,s.inject)(a.W_),this.globalService=(0,s.inject)(a.Uh),this.clients$=new j.X([]),this.folders$=new j.X([])}getCachedClients(){return this.clients$.asObservable()}setCachedClients(e){this.clients$.next(e)}getCachedClient(e){return this.clients$.getValue().find((t=>t.id===e))}addCachedClient(e){this.clients$.next(this.helperService.sortByField([...this.clients$.getValue(),e]))}updateCachedClient(e){this.clients$.next(this.helperService.sortByField([...this.clients$.getValue().filter((t=>t.id!==e.id)),e]))}enableAllCachedClients(e){this.clients$.next(this.helperService.sortByField([...this.clients$.getValue().map((t=>({...t,master_schedule_enabled:e})))]))}removeCachedClient(e){this.clients$.next(this.clients$.getValue().filter((t=>t.id!==e)))}getCachedFolders(){return this.folders$.asObservable()}setCachedFolders(e){this.folders$.next(e)}addCachedFolder(e){this.folders$.next(this.helperService.sortByField([...this.folders$.getValue(),e]))}updateCachedFolder(e){this.folders$.next(this.helperService.sortByField([...this.folders$.getValue().filter((t=>t.id!==e.id)),e]))}removeCachedFolder(e){this.globalService.removeOpenedFolder(),this.folders$.next(this.folders$.getValue().filter((t=>t.id!==e)))}};w=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],w);var I=i(9127),k=i(564),$=i(4978),U=i(7068);let F=class{constructor(){this.httpClient=(0,s.inject)(S.eN),this.clientCacheService=(0,s.inject)(w),this.folderService=(0,s.inject)(a.sg),this.helperService=(0,s.inject)(a.W_),this.toastrService=(0,s.inject)(U._W)}getAllClients(e=!1,t=!1){let i="";return e&&(i+="?",i+=`onlyClientsWithContent=${e}`),t&&(i+=i?"&":"?",i+=`includeFolder=${t}`),this.httpClient.get(`/client/${i}`).pipe((0,I.U)((e=>this.helperService.sortByField(e))),(0,l.b)((e=>this.clientCacheService.setCachedClients(e))))}syncClients(){return this.toastrService.info("Contacting monitoring..."),this.httpClient.get("/client/sync/").pipe((0,l.b)((()=>this.toastrService.success("Sync request sent. It might take some time for the process to complete."))))}getClient(e){return this.httpClient.get(`/client/${e}/`)}createClient(e){return this.httpClient.post("/client/",e).pipe((0,l.b)((e=>this.clientCacheService.addCachedClient(e))),(0,l.b)((()=>this.toastrService.success("Client has been created"))))}copyClient(e,t){let i="";return t&&(i+="?",i+=`with_events=${t}`),this.httpClient.post(`/client/${e}/copy/${i}`,{}).pipe((0,l.b)((e=>this.clientCacheService.addCachedClient(e))),(0,l.b)((()=>this.toastrService.success("Client has been created"))))}updateClient(e,t){return this.httpClient.put(`/client/${t}/`,e).pipe((0,l.b)((e=>this.clientCacheService.updateCachedClient(e))),(0,l.b)((()=>this.toastrService.success("Client has been updated"))))}enableMasterSchedule(e=!1,t){return t?this.httpClient.put(`/client/${t}/master-schedule/?master-schedule=${e}`,{id:t}).pipe((0,l.b)((e=>this.clientCacheService.updateCachedClient(e))),(0,l.b)((()=>this.toastrService.success("Client has been updated")))):this.httpClient.put(`/client/master-schedule/?master-schedule=${e}`,[]).pipe((0,l.b)((()=>this.clientCacheService.enableAllCachedClients(e))),(0,l.b)((()=>this.toastrService.success("All Clients have been updated"))))}deleteClient(e){return this.httpClient.delete(`/client/${e}/`).pipe((0,l.b)((()=>this.clientCacheService.removeCachedClient(e))),(0,l.b)((()=>this.toastrService.success("Client has been deleted"))))}getAllClientFolders(){return this.folderService.getAllFolders("client").pipe((0,l.b)((e=>this.clientCacheService.setCachedFolders(e))))}getClientFolder(e){return this.folderService.getFolder("client",e)}createClientFolder(e){return this.folderService.createFolder("client",e).pipe((0,l.b)((e=>this.clientCacheService.addCachedFolder(e))),(0,l.b)((()=>this.toastrService.success("Client Folder has been created"))))}updateClientFolder(e,t){return this.folderService.updateFolder("client",e,t).pipe((0,l.b)((e=>this.clientCacheService.updateCachedFolder(e))),(0,l.b)((()=>this.toastrService.success("Client Folder has been updated"))))}deleteClientFolder(e){return this.folderService.deleteFolder("client",e).pipe((0,l.b)((()=>this.clientCacheService.removeCachedFolder(e))),(0,l.b)((()=>this.toastrService.success("Client Folder has been deleted"))))}getClientFileSystem(e=!1){return(0,k.a)([this.getAllClientFolders(),this.getAllClients(e)]).pipe((0,$.w)((()=>(0,k.a)([this.clientCacheService.getCachedFolders(),this.clientCacheService.getCachedClients()]))),(0,I.U)((([e,t])=>[e.map((e=>({...e,folders:[],clients:[],type:"folder"}))),t.map((e=>({...e,type:"client"})))])),(0,I.U)((([e,t])=>[e.map((t=>(t.parent&&e.find((e=>e.id===t.parent))?.folders.push(t),t))),t.map((t=>(t.parent&&e.find((e=>e.id===t.parent))?.clients.push(t),t)))])),(0,I.U)((([e,t])=>({folders:e.filter((e=>!e.parent)),items:t.filter((e=>!e.parent))}))))}getFilterList(){return this.httpClient.get("/filter/data/")}getProgramList(){return this.httpClient.get("/program/").pipe((0,I.U)((e=>e.map((e=>({id:e.id,name:e.name}))))))}getPromotionList(){return this.httpClient.get("/promotion/")}};F=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],F);let G=class{constructor(){this.router=(0,s.inject)(d.F0),this.globalService=(0,s.inject)(a.Uh),this.clientService=(0,s.inject)(F),this.fullFileSystem=null,this.fileSystemSlice=null,this.itemCategory="client",this.search="",this.playlistPrefixList=y}ngOnInit(){this.currentItem$=this.globalService.getCurrentItem().pipe((0,l.b)((e=>e?this.setSelectedItem(e):null)),(0,f.d)()),this.openedFolder$=this.globalService.getOpenedFolder()}openFolder(e,t){return this.globalService.isEqual(e)?e.parent?this.globalService.setOpenedFolder({id:e.parent,type:"folder"}):this.globalService.removeOpenedFolder():this.globalService.setOpenedFolder({id:e.id,type:t})}select(e,t){if(("schedule"!==this.itemCategory||"folder"!==t)&&"master-schedule"!==this.itemCategory)return this.globalService.setCurrentItem({id:e,category:"folder"===t?t:"client"}),this.router.navigateByUrl(`${this.itemCategory}s/${t}/${e}`)}setSelectedItem(e){const t=[...this.fullFileSystem?.folders.map((e=>e))||[],...this.fullFileSystem?.items?.map((e=>e))||[]],i=this.findItem(t,e?.id||null,e?.category);if(i&&(i?.parent||i?.program)&&!this.globalService.getOpenedFolderValue()){const e=i?.parent;this.globalService.setOpenedFolder(this.findItem(t,e))}}findItem(e,t,i){if(!e?.length)return null;const r=e?.find((e=>e?.id===t&&(!i||e?.type===i)));return r||this.findItem(e?.map((e=>[...e?.folders||[],...e?.clients||[]])).filter((e=>e.length)).flat()||[],t,i)}enableMasterSchedule(e,t){this.clientService.enableMasterSchedule(t,e).subscribe()}};(0,r.gn)([(0,s.Input)()],G.prototype,"fullFileSystem",void 0),(0,r.gn)([(0,s.Input)()],G.prototype,"fileSystemSlice",void 0),(0,r.gn)([(0,s.Input)()],G.prototype,"itemCategory",void 0),(0,r.gn)([(0,s.Input)()],G.prototype,"search",void 0),G=(0,r.gn)([(0,s.Component)({selector:"app-folder-tree",templateUrl:"./folder-tree.component.html",styleUrls:["./folder-tree.component.scss"]})],G);let V=class{constructor(){this.dialogRef=(0,s.inject)(m.so),this.formBuilder=(0,s.inject)(u.qu),this.clientService=(0,s.inject)(F),this.data=(0,s.inject)(m.WI)}ngOnInit(){this.formGroup=this.formBuilder.group({name:["",u.kI.required]})}createFolder(){this.clientService.createClientFolder(this.formGroup.get("name")?.value).subscribe((e=>this.dialogRef.close(e)))}};V=(0,r.gn)([(0,s.Component)({selector:"app-create-folder-dialog",templateUrl:"./create-folder-dialog.component.html",styleUrls:["./create-folder-dialog.component.scss"]})],V);let L=class{constructor(){this.dialog=(0,s.inject)(m.uw),this.router=(0,s.inject)(d.F0),this.globalService=(0,s.inject)(a.Uh),this.showCopyButton=!1,this.showSyncButton=!1,this.itemCreation=new s.EventEmitter,this.itemCopied=new s.EventEmitter,this.itemDeletion=new s.EventEmitter,this.syncClicked=new s.EventEmitter}ngOnInit(){this.currentItem$=this.globalService.getCurrentItem()}createFolder(){this.dialog.open(V).afterClosed().subscribe((e=>{e&&this.router.navigateByUrl(`/clients/folder/${e.id}`)}))}create(){this.itemCreation.emit()}copy(e){this.itemCopied.emit(e)}delete(e){this.itemDeletion.emit(e)}sync(){this.syncClicked.emit()}};(0,r.gn)([(0,s.Input)()],L.prototype,"showCopyButton",void 0),(0,r.gn)([(0,s.Input)()],L.prototype,"showSyncButton",void 0),(0,r.gn)([(0,s.Output)()],L.prototype,"itemCreation",void 0),(0,r.gn)([(0,s.Output)()],L.prototype,"itemCopied",void 0),(0,r.gn)([(0,s.Output)()],L.prototype,"itemDeletion",void 0),(0,r.gn)([(0,s.Output)()],L.prototype,"syncClicked",void 0),L=(0,r.gn)([(0,s.Component)({selector:"app-list-buttons",templateUrl:"./list-buttons.component.html",styleUrls:["./list-buttons.component.scss"]})],L);let O=class{constructor(){this.label=""}enable(e){e?(this.group.get("openingHours")?.enable(),this.group.get("openingMinutes")?.enable(),this.group.get("closingHours")?.enable(),this.group.get("closingMinutes")?.enable()):(this.group.reset(),this.group.get("openingHours")?.disable(),this.group.get("openingMinutes")?.disable(),this.group.get("closingHours")?.disable(),this.group.get("closingMinutes")?.disable())}increase(e,t){if(this.group.get("open")?.value){const i=parseInt(e.value||0);e.setValue(i+1),this.updateValue(e,t)}}decrease(e,t){if(this.group.get("open")?.value){const i=parseInt(e.value||0);e.setValue(i-1),this.updateValue(e,t)}}setDefault(e){if(e.value){const t=parseInt(e.value||0);e.setValue(t)}}updateValue(e,t){const i=parseInt(e.value||0);return i<0?e.setValue("00"):i<10?e.setValue(`0${i}`):i>24&&"HH"===t?e.setValue("23"):i>59&&"mm"===t?e.setValue("59"):void 0}};(0,r.gn)([(0,s.Input)()],O.prototype,"label",void 0),(0,r.gn)([(0,s.Input)()],O.prototype,"group",void 0),O=(0,r.gn)([(0,s.Component)({selector:"app-custom-working-hours-input",templateUrl:"./custom-working-hours-input.component.html",styleUrls:["./custom-working-hours-input.component.scss"]})],O);var P=i(9248),E=i(9797),B=i(9160),_=i(2799);let D=class{constructor(){this.events=[],this.isLoading=!1,this.selectedEventId=new s.EventEmitter,this.currentDateInterval=new s.EventEmitter,this.view=E.wr.Week,this.CalendarView=E.wr,this.viewDate=new Date,this.refresh=new P.x,this.activeDayIsOpen=!0}ngOnInit(){this.initiateDateInterval()}initiateDateInterval(){const e=new Date(this.viewDate),t=e.getDay(),i=e.getDate()-t+(0==t?-6:0);this.currentDateInterval.emit([new Date(e.setDate(i)).toISOString().substring(0,10),new Date(e.setDate(i+6)).toISOString().substring(0,10)])}dayClicked({date:e,events:t}){(0,B.Z)(e,this.viewDate)&&(this.activeDayIsOpen=!((0,_.Z)(this.viewDate,e)&&this.activeDayIsOpen||0===t.length),this.viewDate=e)}handleEvent(e,t){this.selectedEventId.emit(parseInt(t.id))}setView(e){this.view=e}closeOpenMonthViewDay(){this.activeDayIsOpen=!1,this.initiateDateInterval()}};(0,r.gn)([(0,s.Input)()],D.prototype,"events",void 0),(0,r.gn)([(0,s.Input)()],D.prototype,"isLoading",void 0),(0,r.gn)([(0,s.Output)()],D.prototype,"selectedEventId",void 0),(0,r.gn)([(0,s.Output)()],D.prototype,"currentDateInterval",void 0),D=(0,r.gn)([(0,s.Component)({selector:"app-scheduler",templateUrl:"./scheduler.component.html",styleUrls:["./scheduler.component.scss"]})],D);var M=i(179),x=i(381);let A=class{constructor(){this.label="",this.placeholder=""}};(0,r.gn)([(0,s.Input)()],A.prototype,"label",void 0),(0,r.gn)([(0,s.Input)()],A.prototype,"placeholder",void 0),(0,r.gn)([(0,s.Input)()],A.prototype,"control",void 0),A=(0,r.gn)([(0,s.Component)({selector:"app-custom-date-time-input",templateUrl:"./custom-date-time-input.component.html",styleUrls:["./custom-date-time-input.component.scss"]})],A);var T=i(2817);let z=class{constructor(){this.clientService=(0,s.inject)(F),this.clientCacheService=(0,s.inject)(w)}transform(e){const t=this.clientCacheService.getCachedClient(e);return t?(0,T.of)(t):this.clientService.getClient(e)}};z=(0,r.gn)([(0,s.Pipe)({name:"getClient"})],z);class W extends E.hl{dayViewHour({date:e,locale:t}){return new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"numeric"}).format(e)}}let H=class{};H=(0,r.gn)([(0,s.NgModule)({declarations:[v,g,b,V,C,G,L,O,D,A,z],imports:[n.ez,a.hd,u.UX,n.Zd,u.u5,a.pC,E._8.forRoot({provide:E._A,useFactory:function(){return(0,M.x)(x)}},{dateFormatter:{provide:E.m$,useClass:W}})],exports:[v,C,G,L,O,D,A],providers:[{provide:s.LOCALE_ID,useValue:"en-GB"},{provide:E.n4,useValue:x},{provide:m.Bq,useValue:{maxWidth:400,minWidth:400}}]})],H);var q=i(4975);let N=class{constructor(){this.router=(0,s.inject)(d.F0),this.userService=(0,s.inject)(a.KD),this.globalService=(0,s.inject)(a.Uh),this.dialog=(0,s.inject)(m.uw)}ngOnInit(){this.userList$=this.userService.getUserData().pipe((0,f.d)()),this.currentItem$=this.globalService.getCurrentItem()}select(e){this.globalService.setCurrentItem({id:e,category:"user"}),this.router.navigateByUrl(`/users/user/${e}`)}create(){this.router.navigateByUrl("/users/user/new")}delete(e){this.dialog.open(b,{data:{message:"Are you sure you want to delete this user? This action is irreversible."}}).afterClosed().pipe((0,q.h)((e=>e)),(0,$.w)((()=>this.userService.deleteUser(e.id).pipe((0,l.b)((()=>this.router.navigateByUrl("/users"))))))).subscribe()}};N=(0,r.gn)([(0,s.Component)({selector:"app-users",templateUrl:"./users.component.html",styleUrls:["./users.component.scss"],changeDetection:s.ChangeDetectionStrategy.OnPush})],N);let R=class{};R=(0,r.gn)([(0,s.Component)({selector:"app-user-dashboard",templateUrl:"./user-dashboard.component.html",styleUrls:["./user-dashboard.component.scss"]})],R);const X=[{id:"Superuser",name:"Superuser"},{id:"Admin",name:"Admin"},{id:"User",name:"User"}];let Z=class{constructor(){this.activatedRoute=(0,s.inject)(d.gz),this.formBuilder=(0,s.inject)(u.qu),this.globalService=(0,s.inject)(a.Uh),this.userService=(0,s.inject)(a.KD),this.toastrService=(0,s.inject)(U._W),this.router=(0,s.inject)(d.F0),this.userGroupList=X}ngOnInit(){this.activatedRoute.paramMap.pipe((0,$.w)((e=>(this.userId=parseInt(e.get("id")||""),this.user$=this.userId?this.userService.getUser(this.userId).pipe((0,f.d)()):(0,T.of)(null)))),(0,l.b)((e=>{this.buildForm(),e&&(this.globalService.setCurrentItem({id:this.userId,category:"user"}),this.updateForm(e))}))).subscribe()}ngOnDestroy(){this.userId&&this.globalService.removeCurrentItem()}buildForm(){this.formGroup=this.formBuilder.group({id:[{value:null,disabled:!0}],username:["",u.kI.required],password:[""],group:[null,u.kI.required]}),this.userId||this.formGroup.get("password")?.setValidators(u.kI.required)}updateForm(e){this.formGroup.patchValue(e)}save(){if(this.userId){const e={...this.formGroup.value};return e.password||delete e.password,this.userService.updateUser(e,this.userId).subscribe()}return this.userService.createUser(this.formGroup.value).pipe((0,l.b)((e=>this.router.navigateByUrl(`/users/user/${e.id}`)))).subscribe()}discard(e){this.buildForm(),this.updateForm(e),this.toastrService.success("Changes have been discarded")}};Z=(0,r.gn)([(0,s.Component)({selector:"app-user-editor",templateUrl:"./user-editor.component.html",styleUrls:["./user-editor.component.scss"]})],Z);let K=class{constructor(){this.router=(0,s.inject)(d.F0),this.clientService=(0,s.inject)(F),this.globalService=(0,s.inject)(a.Uh),this.dialog=(0,s.inject)(m.uw),this.searchControl=new u.NI(""),this.withContent=!1}ngOnInit(){this.resetClients(!1)}resetClients(e){this.withContent=e,this.currentFileSystem$=this.clientService.getClientFileSystem(e).pipe((0,f.d)())}select(e){this.globalService.setCurrentItem({id:e,category:"client"}),this.router.navigateByUrl(`clients/client/${e}`)}create(){this.router.navigateByUrl("/clients/client/new")}copy(e){this.dialog.open(b,{data:{message:"Would you like to also copy scheduled events for the client?"}}).afterClosed().pipe((0,$.w)((t=>this.clientService.copyClient(e.id,t))),(0,l.b)((e=>this.select(e.id)))).subscribe()}delete(e){this.dialog.open(b,{data:{message:`Are you sure you want to delete this ${e.category}? This action is irreversible.`}}).afterClosed().pipe((0,q.h)((e=>e)),(0,$.w)((()=>"folder"===e.category?this.clientService.deleteClientFolder(e.id).pipe((0,l.b)((()=>this.router.navigateByUrl("/clients")))):"client"===e.category?this.clientService.deleteClient(e.id).pipe((0,l.b)((()=>this.router.navigateByUrl("/clients")))):(0,T.of)(null)))).subscribe()}sync(){this.dialog.open(b,{data:{message:"Are you sure that you want to sync client and player data?"}}).afterClosed().pipe((0,q.h)((e=>e)),(0,$.w)((()=>this.clientService.syncClients()))).subscribe()}};K=(0,r.gn)([(0,s.Component)({selector:"app-clients",templateUrl:"./clients.component.html",styleUrls:["./clients.component.scss"]})],K);let Y=class{};Y=(0,r.gn)([(0,s.Component)({selector:"app-client-dashboard",templateUrl:"./client-dashboard.component.html",styleUrls:["./client-dashboard.component.scss"]})],Y);let J=class{constructor(){this.activatedRoute=(0,s.inject)(d.gz),this.formBuilder=(0,s.inject)(u.qu),this.globalService=(0,s.inject)(a.Uh),this.clientService=(0,s.inject)(F),this.toastrService=(0,s.inject)(U._W),this.router=(0,s.inject)(d.F0),this.formGroup=null,this.showWorkingHours=!1,this.week=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]}ngOnInit(){this.activatedRoute.paramMap.pipe((0,$.w)((e=>(this.clientId=parseInt(e.get("clientId")||""),this.formGroup=null,this.client$=(0,T.of)(null),this.clientId&&(this.client$=this.clientService.getClient(this.clientId).pipe((0,f.d)())),this.client$))),(0,l.b)((e=>{this.folderList$=this.clientService.getAllClientFolders(),this.filterList$=this.clientService.getFilterList().pipe((0,f.d)()),this.programList$=this.clientService.getProgramList().pipe((0,f.d)()),this.promotionList$=this.clientService.getPromotionList().pipe((0,f.d)()),this.buildForm(),e?(this.globalService.setCurrentItem({id:this.clientId,category:"client"}),this.updateForm(e)):this.addDefaultFilter()}))).subscribe()}ngOnDestroy(){this.clientId&&this.globalService.removeCurrentItem()}buildForm(){this.formGroup=this.formBuilder.group({id:[{value:null,disabled:!0}],name:["",u.kI.required],parent:[null],basic_content:[null],filters:this.formBuilder.array([]),contents:this.formBuilder.array([]),workingHours:this.formBuilder.array([]),promotions:this.formBuilder.array([]),api_key:[{value:"",disabled:!0}],secret_login_key:[{value:"",disabled:!0}],remote_volume_control_enabled:[!1]})}updateForm(e){this.formGroup?.patchValue(e),this.formGroup?.get("basic_content")?.setValue(e.basic_content.object),e.filters.forEach((e=>this.addFilter(e.field,e.word,e.value))),this.week.forEach(((t,i)=>this.addContent(e,i))),this.week.forEach(((t,i)=>this.addWorkingHours(e,i))),this.formGroup?.get("secret_login_key")?.setValue(`${c.N.clientUrl}/secret/${this.formGroup?.get("secret_login_key")?.value}`)}addFilter(e,t,i){const r=this.formGroup?.get("filters");if(e&&t&&i){const s=r.value.find((i=>i.field===e&&i.word===t));if(s)return s.value.push(i)}return(this.formGroup?.get("filters")).push(this.formBuilder.group({field:[e],word:[t],value:[[i]]}))}addDefaultFilter(){this.addFilter("Artist","is not","Sade")}removeFilter(e){(this.formGroup?.get("filters")).removeAt(e)}addContent(e,t){(this.formGroup?.get("contents")).push(this.formBuilder.control(e.contents[t]?.content.object,u.kI.required))}addWorkingHours(e,t){const i=e[`${this.week[t].toLowerCase()}_enabled`],r=e[`${this.week[t].toLowerCase()}_open`]?.split(":")||[],s=e[`${this.week[t].toLowerCase()}_close`]?.split(":")||[];(this.formGroup?.get("workingHours")).push(this.formBuilder.group({open:[i],openingHours:[{value:r[0]?r[0]:null,disabled:!i}],openingMinutes:[{value:r[1]?r[1]:null,disabled:!i}],closingHours:[{value:s[0]?s[0]:null,disabled:!i}],closingMinutes:[{value:s[1]?s[1]:null,disabled:!i}]})),!this.showWorkingHours&&i&&(this.showWorkingHours=!0)}resetWorkingHours(e){this.showWorkingHours=e,(this.formGroup?.get("workingHours")).controls.forEach((e=>{e.reset(),e.get("openingHours")?.disable(),e.get("openingMinutes")?.disable(),e.get("closingHours")?.disable(),e.get("closingMinutes")?.disable()}))}addPromotion(e){const t=e||null;return(this.formGroup?.get("promotions")).push(this.formBuilder.control(t,u.kI.required))}removePromotion(e){(this.formGroup?.get("promotions")).removeAt(e)}save(){const e=this.getClientDataForPayload();return this.clientId?this.clientService.updateClient(e,this.clientId).subscribe((e=>{this.client$=this.clientService.getClient(this.clientId).pipe((0,f.d)()),this.buildForm(),this.updateForm(e)})):this.clientService.createClient(e).subscribe((e=>{this.router.navigateByUrl(`/clients/client/${e.id}`)}))}getClientDataForPayload(){const e=this.formGroup?.value,t=(this.formGroup?.get("workingHours")).controls;return t.length&&Object.assign(e,this.week.map(((e,i)=>({[`${e.toLowerCase()}_enabled`]:t[i].get("open")?.value||!1,[`${e.toLowerCase()}_open`]:this.getOpeningHours(t[i]),[`${e.toLowerCase()}_close`]:this.getClosingHours(t[i])}))).flat().reduce(((e,t)=>Object.assign(e,t)),{})),e.basic_content={id:`pr${e.basic_content.id}`,object:e.basic_content,type:"program"},e.contents=e.contents.filter((e=>e)).map((e=>({content:{id:`pr${e.id}`,object:e,type:"program"}}))),e.filters=e.filters?.map((e=>e.value.map((t=>({field:e.field,word:e.word,value:t}))))).flat(),e.promotions=e.promotions.filter((e=>e)).map((e=>({promotion_id:e.id,promotion:e.name}))),delete e.workingHours,e}getOpeningHours(e){return e.get("open")?.value&&e.get("openingHours")?.value&&e.get("openingMinutes")?.value?`${e.get("openingHours")?.value}:${e.get("openingMinutes")?.value}:00`:null}getClosingHours(e){return e.get("open")?.value&&e.get("closingHours")?.value&&e.get("closingMinutes")?.value?`${e.get("closingHours")?.value}:${e.get("closingMinutes")?.value}:00`:null}discard(e){this.buildForm(),this.updateForm(e),this.toastrService.success("Changes have been discarded")}};J=(0,r.gn)([(0,s.Component)({selector:"app-client-editor",templateUrl:"./client-editor.component.html",styleUrls:["./client-editor.component.scss"]})],J);let Q=class{constructor(){this.helperService=(0,s.inject)(a.W_),this.playerVersions$=new j.X([])}getCachedPlayerVersions(){return this.playerVersions$.asObservable()}setCachedPlayerVersions(e){this.playerVersions$.next(e)}addCachedPlayerVersion(e){this.playerVersions$.next(this.helperService.sortVersions([...this.playerVersions$.getValue(),e],"version_string","desc"))}updateCachedPlayerVersion(e){this.playerVersions$.next(this.helperService.sortVersions([...this.playerVersions$.getValue().filter((t=>t.id!==e.id)),e],"version_string","desc"))}};Q=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],Q);let ee=class{constructor(){this.httpClient=(0,s.inject)(S.eN),this.playerVersionCacheService=(0,s.inject)(Q),this.helperService=(0,s.inject)(a.W_),this.toastrService=(0,s.inject)(U._W)}getAllPlayerVersions(){return this.httpClient.get("/player-version/").pipe((0,I.U)((e=>this.helperService.sortVersions(e,"version_string","desc"))),(0,l.b)((e=>this.playerVersionCacheService.setCachedPlayerVersions(e))))}getCurrentPlayerVersion(){return this.playerVersionCacheService.getCachedPlayerVersions().pipe((0,I.U)((e=>e.find((e=>e.current))||null)))}getPlayerVersion(e){return this.playerVersionCacheService.getCachedPlayerVersions().pipe((0,I.U)((t=>t.find((t=>t.id===e)))))}updatePlayerVersion(e){return this.getPlayerVersion(e).pipe((0,I.U)((e=>({...e,current:!0}))),(0,$.w)((t=>this.httpClient.put(`/player-version/${e}/`,t))))}uploadArtifact(e){return this.httpClient.post("/s3/sign-upload-request/",{file_name:e.name,file_type:e.type}).pipe((0,l.b)((t=>this.httpClient.post(t.data.url,{...t.data.fields,file:e}))),(0,I.U)((e=>e.url)))}addPlayerVersion(e){return this.httpClient.post("/player-version/",e).pipe((0,l.b)((e=>this.playerVersionCacheService.addCachedPlayerVersion(e))),(0,l.b)((()=>this.toastrService.success("Player Version has been added"))))}};ee=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],ee);let te=class{constructor(){this.router=(0,s.inject)(d.F0),this.playerVersionService=(0,s.inject)(ee),this.globalService=(0,s.inject)(a.Uh),this.optionList=[]}ngOnInit(){this.playerVersionList$=this.playerVersionService.getAllPlayerVersions().pipe((0,f.d)(),(0,l.b)((e=>this.optionList=e.map((e=>({id:e.id,name:e.version_string}))))),(0,l.b)((()=>this.currentPlayerVersion$=this.playerVersionService.getCurrentPlayerVersion().pipe((0,l.b)((e=>this.versionControl=new u.NI({value:e?.id,disabled:!0}))))))),this.currentItem$=this.globalService.getCurrentItem()}select(e){this.globalService.setCurrentItem({id:e,category:"player-version"}),this.router.navigateByUrl(`/player-versions/player-version/${e}`)}create(){this.router.navigateByUrl("/player-versions/player-version/new")}editPlayerVersion(){this.versionControl.enable()}savePlayerVersion(){this.playerVersionService.updatePlayerVersion(parseInt(this.versionControl.value)).subscribe((()=>this.versionControl.disable()))}};te=(0,r.gn)([(0,s.Component)({selector:"app-player-versions",templateUrl:"./player-versions.component.html",styleUrls:["./player-versions.component.scss"]})],te);let ie=class{constructor(){this.activatedRoute=(0,s.inject)(d.gz),this.formBuilder=(0,s.inject)(u.qu),this.globalService=(0,s.inject)(a.Uh),this.playerVersionService=(0,s.inject)(ee),this.router=(0,s.inject)(d.F0)}ngOnInit(){this.activatedRoute.paramMap.pipe((0,$.w)((e=>(this.versionId=parseInt(e.get("id")||""),this.version$=this.versionId?this.playerVersionService.getPlayerVersion(this.versionId).pipe((0,f.d)()):(0,T.of)(null)))),(0,l.b)((e=>{this.buildForm(),e&&(this.globalService.setCurrentItem({id:this.versionId,category:"player-version"}),this.updateForm(e))}))).subscribe()}ngOnDestroy(){this.versionId&&this.globalService.removeCurrentItem()}buildForm(){this.formGroup=this.formBuilder.group({id:[null],version_string:["",u.kI.required],link:["",u.kI.required],current:[!1]})}updateForm(e){this.formGroup.patchValue(e),this.formGroup.disable()}uploadArtifact(e){this.playerVersionService.uploadArtifact(e).pipe((0,l.b)((e=>this.formGroup.get("link")?.setValue(e)))).subscribe()}save(){this.playerVersionService.addPlayerVersion(this.formGroup.value).pipe((0,l.b)((e=>this.router.navigateByUrl(`/player-versions/player-version/${e.id}`)))).subscribe()}};ie=(0,r.gn)([(0,s.Component)({selector:"app-player-version-editor",templateUrl:"./player-version-editor.component.html",styleUrls:["./player-version-editor.component.scss"]})],ie);let re=class{constructor(){this.formBuilder=(0,s.inject)(u.qu),this.activatedRoute=(0,s.inject)(d.gz),this.clientService=(0,s.inject)(F),this.globalService=(0,s.inject)(a.Uh)}ngOnInit(){(0,k.a)([this.activatedRoute.paramMap,this.activatedRoute.data]).pipe((0,I.U)((([e,t])=>{const i=parseInt(e?.get("id")||"");return this.globalService.setCurrentItem({id:i,category:"folder"}),i})),(0,$.w)((e=>this.clientService.getClientFolder(e)))).subscribe((e=>{this.folderList$=this.clientService.getAllClientFolders().pipe((0,I.U)((e=>e.map((e=>({name:e.name,id:e.id})))))),this.formGroup=this.formBuilder.group({name:["",u.kI.required],parent:[null]}),e&&(this.currentFolder=e,this.formGroup.patchValue(e))}))}ngOnDestroy(){this.globalService.removeCurrentItem()}save(){const e={id:this.currentFolder.id,name:this.formGroup.get("name")?.value,parent:"null"!==this.formGroup.get("parent")?.value?this.formGroup.get("parent")?.value:null};return this.clientService.updateClientFolder(this.currentFolder.id,e).subscribe()}};re=(0,r.gn)([(0,s.Component)({selector:"app-folder-editor",templateUrl:"./folder-editor.component.html",styleUrls:["./folder-editor.component.scss"]})],re);let se=class{constructor(){this.router=(0,s.inject)(d.F0),this.clientService=(0,s.inject)(F),this.globalService=(0,s.inject)(a.Uh),this.searchControl=new u.NI("")}ngOnInit(){this.currentFileSystem$=this.clientService.getClientFileSystem().pipe((0,f.d)())}select(e){this.globalService.setCurrentItem({id:e,category:"client"}),this.router.navigateByUrl(`schedules/schedule/${e}`)}};se=(0,r.gn)([(0,s.Component)({selector:"app-schedules",templateUrl:"./schedules.component.html",styleUrls:["./schedules.component.scss"]})],se);let ne=class{};ne=(0,r.gn)([(0,s.Component)({selector:"app-schedule-dashboard",templateUrl:"./schedule-dashboard.component.html",styleUrls:["./schedule-dashboard.component.scss"]})],ne);let oe=class{constructor(){this.helperService=(0,s.inject)(a.W_),this.events$=new j.X([])}getCachedEvents(){return this.events$.asObservable()}setCachedEvents(e){this.events$.next(e)}addCachedEvent(e){this.events$.next(this.helperService.sortByField([...this.events$.getValue(),e]))}updateCachedEvent(e){this.events$.next(this.helperService.sortByField([...this.events$.getValue().filter((t=>t.id!==e.id)),e]))}removeCachedEvent(e){this.events$.next(this.events$.getValue().filter((t=>t.id!==e)))}};oe=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],oe);let le=class{constructor(){this.httpClient=(0,s.inject)(S.eN),this.scheduleCacheService=(0,s.inject)(oe),this.toastrService=(0,s.inject)(U._W)}getScheduleByTime(e,t,i){return this.httpClient.get(`/${t}/${e}/schedule/${i}`).pipe((0,I.U)((e=>this.formatEvent(e))))}getEvent(e,t){return this.httpClient.get(`/${t}/${e}/`)}createEvent(e,t){return this.httpClient.post(`/${e}/`,t).pipe((0,l.b)((e=>this.scheduleCacheService.addCachedEvent(e))),(0,l.b)((()=>this.toastrService.success("Event has been created"))))}updateEvent(e,t,i){return this.httpClient.put(`/${t}/${e}/`,i).pipe((0,l.b)((e=>this.scheduleCacheService.updateCachedEvent(e))),(0,l.b)((()=>this.toastrService.success("Event has been updated"))))}deleteEvent(e,t){return this.httpClient.delete(`/${t}/${e}/`).pipe((0,l.b)((()=>this.scheduleCacheService.removeCachedEvent(e))),(0,l.b)((()=>this.toastrService.success("Event has been deleted"))))}formatEvent(e){return Object.entries(e.event_dates).map((([t,i])=>{const r=e.events.find((e=>e.id===parseInt(t)))?.content.object;return i.map((e=>({id:t,start:new Date(new Date(e.start).toUTCString().substring(0,25)),end:new Date(new Date(e.end).toUTCString().substring(0,25)),title:`${e.start.slice(11,16)} - ${e.end.slice(11,16)}: \n${r.prefix} ${r.name}`,color:{primary:r.color,secondary:r.color},isClickable:!0,isDisabled:!1})))})).flat()}};le=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],le);let ae=class{constructor(){this.clientService=(0,s.inject)(F),this.scheduleService=(0,s.inject)(le),this.globalService=(0,s.inject)(a.Uh),this.activatedRoute=(0,s.inject)(d.gz),this.isEditorOpened=!1,this.isLoading=!1,this.currentDateInterval=[]}ngOnInit(){this.client$=this.activatedRoute.paramMap.pipe((0,$.w)((e=>(this.clientId=parseInt(e.get("clientId")||""),this.globalService.setCurrentItem({id:this.clientId,category:"client"}),this.setEvents([]),this.clientService.getClient(this.clientId).pipe((0,f.d)())))),(0,l.b)((e=>{this.programList$=this.clientService.getProgramList().pipe((0,f.d)()),this.contentControl=new u.NI(e?.basic_content.object)})))}ngOnDestroy(){this.clientId&&this.globalService.removeCurrentItem()}setEvents(e){this.isLoading=!0,e.length&&(this.currentDateInterval=[...e]),this.events$=this.scheduleService.getScheduleByTime(this.clientId,"client",`?schedule_end=${this.currentDateInterval[1]}&schedule_start=${this.currentDateInterval[0]}`).pipe((0,l.b)((()=>this.isLoading=!1)))}selectEvent(e){this.currentEventId=e,this.isEditorOpened=!0}save(e){this.clientService.updateClient({...e,basic_content:{id:`pr${this.contentControl?.value?.id}`,object:this.contentControl?.value,type:"program"}},e.id).pipe((0,l.b)((()=>this.setEvents([])))).subscribe()}open(){this.isEditorOpened=!0}close(){this.isEditorOpened=!1,this.currentEventId=null}};ae=(0,r.gn)([(0,s.Component)({selector:"app-schedule-editor",templateUrl:"./schedule-editor.component.html",styleUrls:["./schedule-editor.component.scss"]})],ae);let ce=class{constructor(){this.helperService=(0,s.inject)(a.W_),this.previews$=new j.X([])}getCachedLinkPreviews(){return this.previews$.asObservable()}setCachedLinkPreviews(e){this.previews$.next(e)}addCachedLinkPreview(e){this.previews$.next(this.helperService.sortByField([...this.previews$.getValue(),e]))}updateCachedLinkPreview(e){this.previews$.next(this.helperService.sortByField([...this.previews$.getValue().filter((t=>t.id!==e.id)),e]))}removeCachedLinkPreview(e){this.previews$.next(this.previews$.getValue().filter((t=>t.id!==e)))}};ce=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],ce);let he=class{constructor(){this.httpClient=(0,s.inject)(S.eN),this.previewLinkCacheService=(0,s.inject)(ce),this.helperService=(0,s.inject)(a.W_),this.toastrService=(0,s.inject)(U._W)}getAllLinkPreviews(){return this.httpClient.get("/program-preview-link/").pipe((0,I.U)((e=>this.helperService.sortByDateField(e,"expiration_date").reverse())),(0,l.b)((e=>this.previewLinkCacheService.setCachedLinkPreviews(e))),(0,$.w)((()=>this.previewLinkCacheService.getCachedLinkPreviews())))}getAllCachedLinkPreviews(){return this.previewLinkCacheService.getCachedLinkPreviews()}getLinkPreview(e){return this.httpClient.get(`/program-preview-link/${e}/`)}createLinkPreview(e){return this.httpClient.post("/program-preview-link/",e).pipe((0,l.b)((e=>this.previewLinkCacheService.addCachedLinkPreview(e))),(0,l.b)((()=>this.toastrService.success("Link Preview has been created"))))}updateLinkPreview(e,t){return this.httpClient.put(`/program-preview-link/${e}/`,t).pipe((0,l.b)((e=>this.previewLinkCacheService.updateCachedLinkPreview(e))),(0,l.b)((()=>this.toastrService.success("Link Preview has been updated"))))}deleteLinkPreview(e){return this.httpClient.delete(`/program-preview-link/${e}/`).pipe((0,l.b)((()=>this.previewLinkCacheService.removeCachedLinkPreview(e))),(0,l.b)((()=>this.toastrService.success("Link Preview has been deleted"))))}};he=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],he);let pe=class{constructor(){this.linkPreviewService=(0,s.inject)(he),this.router=(0,s.inject)(d.F0),this.dialog=(0,s.inject)(m.uw)}ngOnInit(){this.previewLinks$=this.linkPreviewService.getAllLinkPreviews()}add(){this.router.navigateByUrl("/link-previews/link-preview/new")}edit(e){this.router.navigateByUrl(`/link-previews/link-preview/${e}`)}remove(e){this.dialog.open(b,{data:{message:"Are you sure you want to delete this link preview? This action is irreversible."}}).afterClosed().pipe((0,q.h)((e=>e)),(0,$.w)((()=>this.linkPreviewService.deleteLinkPreview(e)))).subscribe()}};pe=(0,r.gn)([(0,s.Component)({selector:"app-link-previews",templateUrl:"./link-previews.component.html",styleUrls:["./link-previews.component.scss"]})],pe);let de=class{constructor(){this.activatedRoute=(0,s.inject)(d.gz),this.formBuilder=(0,s.inject)(u.qu),this.linkPreviewService=(0,s.inject)(he),this.clientService=(0,s.inject)(F),this.router=(0,s.inject)(d.F0)}ngOnInit(){this.activatedRoute.paramMap.pipe((0,$.w)((e=>(this.previewId=parseInt(e.get("previewLinkId")||""),this.preview$=(0,T.of)(null),this.previewId&&(this.preview$=this.linkPreviewService.getLinkPreview(this.previewId).pipe((0,f.d)())),this.preview$))),(0,l.b)((e=>{this.programList$=this.clientService.getProgramList().pipe((0,f.d)()),this.buildForm(),e&&this.updateForm(e)}))).subscribe()}buildForm(){this.formGroup=this.formBuilder.group({id:[{value:null,disabled:!0}],name:["",u.kI.required],program:[null],expiration_date:[""]})}updateForm(e){this.formGroup.patchValue(e),this.formGroup.get("program")?.setValue({id:e.program.id,name:e.program.name})}save(){return this.previewId?this.linkPreviewService.updateLinkPreview(this.previewId,{...this.formGroup.value,program:this.formGroup.get("program")?.value?.id}).subscribe():this.linkPreviewService.createLinkPreview({...this.formGroup.value,program:this.formGroup.get("program")?.value?.id}).pipe((0,l.b)((e=>this.router.navigateByUrl(`link-previews/link-preview/${e.id}`)))).subscribe()}discard(e){this.buildForm(),this.updateForm(e)}};de=(0,r.gn)([(0,s.Component)({selector:"app-link-preview-editor",templateUrl:"./link-preview-editor.component.html",styleUrls:["./link-preview-editor.component.scss"]})],de);let ue=class{constructor(){this.clientService=(0,s.inject)(F),this.scheduleService=(0,s.inject)(le),this.globalService=(0,s.inject)(a.Uh),this.isEditorOpened=!1,this.isLoading=!1,this.currentDateInterval=[],this.searchControl=new u.NI("")}ngOnInit(){this.currentFileSystem$=this.clientService.getClientFileSystem().pipe((0,f.d)())}ngOnDestroy(){this.globalService.removeCurrentItem()}setEvents(e){this.isLoading=!0,e.length&&(this.currentDateInterval=[...e]),this.events$=this.scheduleService.getScheduleByTime(-1,"client",`?schedule_end=${this.currentDateInterval[1]}&schedule_start=${this.currentDateInterval[0]}`).pipe((0,l.b)((()=>this.isLoading=!1)))}selectEvent(e){this.currentEventId=e,this.isEditorOpened=!0}open(){this.isEditorOpened=!0}close(){this.isEditorOpened=!1,this.currentEventId=null}enableAll(e){this.clientService.enableMasterSchedule(e).subscribe()}};ue=(0,r.gn)([(0,s.Component)({selector:"app-master-schedules",templateUrl:"./master-schedules.component.html",styleUrls:["./master-schedules.component.scss"]})],ue);let ve=class{constructor(){this.helperService=(0,s.inject)(a.W_),this.clientGroups$=new j.X([])}getCachedClientGroups(){return this.clientGroups$.asObservable()}setCachedClientGroups(e){this.clientGroups$.next(e)}addCachedClientGroup(e){this.clientGroups$.next(this.helperService.sortByField([...this.clientGroups$.getValue(),e]))}updateCachedClientGroup(e){this.clientGroups$.next(this.helperService.sortByField([...this.clientGroups$.getValue().filter((t=>t.id!==e.id)),e]))}removeCachedClientGroup(e){this.clientGroups$.next(this.clientGroups$.getValue().filter((t=>t.id!==e)))}};ve=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],ve);let ge=class{constructor(){this.httpClient=(0,s.inject)(S.eN),this.clientGroupCacheService=(0,s.inject)(ve),this.helperService=(0,s.inject)(a.W_),this.toastrService=(0,s.inject)(U._W)}getAllClientGroups(){return this.httpClient.get("/client-group/").pipe((0,I.U)((e=>this.helperService.sortByField(e))),(0,l.b)((e=>this.clientGroupCacheService.setCachedClientGroups(e))),(0,$.w)((()=>this.clientGroupCacheService.getCachedClientGroups())))}getClientGroup(e){return this.httpClient.get(`/client-group/${e}/`)}createClientGroup(e){return this.httpClient.post("/client-group/",e).pipe((0,l.b)((e=>this.clientGroupCacheService.addCachedClientGroup(e))),(0,l.b)((()=>this.toastrService.success("Client Group has been created"))))}updateClientGroup(e,t){return this.httpClient.put(`/client-group/${t}/`,e).pipe((0,l.b)((e=>this.clientGroupCacheService.updateCachedClientGroup(e))),(0,l.b)((()=>this.toastrService.success("Client Group has been updated"))))}deleteClientGroup(e){return this.httpClient.delete(`/client-group/${e}/`).pipe((0,l.b)((()=>this.clientGroupCacheService.removeCachedClientGroup(e))),(0,l.b)((()=>this.toastrService.success("Client Group has been deleted"))))}};ge=(0,r.gn)([(0,s.Injectable)({providedIn:"root"})],ge);let me=class{constructor(){this.router=(0,s.inject)(d.F0),this.clientGroupService=(0,s.inject)(ge),this.globalService=(0,s.inject)(a.Uh),this.dialog=(0,s.inject)(m.uw)}ngOnInit(){this.currentItem$=this.globalService.getCurrentItem().pipe((0,f.d)()),this.groups$=this.clientGroupService.getAllClientGroups().pipe((0,f.d)())}select(e){this.globalService.setCurrentItem({id:e,category:"client-group"}),this.router.navigateByUrl(`/client-groups/client-group/${e}`)}create(){this.router.navigateByUrl("/client-groups/client-group/new")}edit(e){this.router.navigateByUrl(`/client-groups/client-group/${e.id}/edit`)}delete(e){this.dialog.open(b,{data:{message:"Are you sure you want to delete this client group? This action is irreversible."}}).afterClosed().pipe((0,q.h)((e=>e)),(0,$.w)((()=>this.clientGroupService.deleteClientGroup(e.id).pipe((0,l.b)((()=>this.router.navigateByUrl("/client-groups"))))))).subscribe()}};me=(0,r.gn)([(0,s.Component)({selector:"app-client-groups",templateUrl:"./client-groups.component.html",styleUrls:["./client-groups.component.scss"]})],me);let be=class{};be=(0,r.gn)([(0,s.Component)({selector:"app-client-group-dashboard",templateUrl:"./client-group-dashboard.component.html",styleUrls:["./client-group-dashboard.component.scss"]})],be);let Ce=class{constructor(){this.clientGroupService=(0,s.inject)(ge),this.scheduleService=(0,s.inject)(le),this.globalService=(0,s.inject)(a.Uh),this.activatedRoute=(0,s.inject)(d.gz),this.isEditorOpened=!1,this.isLoading=!1,this.currentDateInterval=[]}ngOnInit(){this.group$=this.activatedRoute.paramMap.pipe((0,$.w)((e=>(this.groupId=parseInt(e.get("id")||""),this.globalService.setCurrentItem({id:this.groupId,category:"client-group"}),this.setEvents([]),this.clientGroupService.getClientGroup(this.groupId).pipe((0,f.d)())))))}ngOnDestroy(){this.groupId&&this.globalService.removeCurrentItem()}setEvents(e){this.isLoading=!0,e.length&&(this.currentDateInterval=[...e]),this.events$=this.scheduleService.getScheduleByTime(this.groupId,"client-group",`?schedule_end=${this.currentDateInterval[1]}&schedule_start=${this.currentDateInterval[0]}`).pipe((0,l.b)((()=>this.isLoading=!1)))}selectEvent(e){this.currentEventId=e,this.isEditorOpened=!0}open(){this.isEditorOpened=!0}close(){this.isEditorOpened=!1,this.currentEventId=null}};Ce=(0,r.gn)([(0,s.Component)({selector:"app-client-group-schedule",templateUrl:"./client-group-schedule.component.html",styleUrls:["./client-group-schedule.component.scss"]})],Ce);let ye=class{constructor(){this.activatedRoute=(0,s.inject)(d.gz),this.formBuilder=(0,s.inject)(u.qu),this.globalService=(0,s.inject)(a.Uh),this.clientGroupService=(0,s.inject)(ge),this.clientService=(0,s.inject)(F),this.toastrService=(0,s.inject)(U._W),this.router=(0,s.inject)(d.F0)}ngOnInit(){this.activatedRoute.paramMap.pipe((0,$.w)((e=>(this.groupId=parseInt(e.get("id")||""),this.group$=this.groupId?this.clientGroupService.getClientGroup(this.groupId).pipe((0,f.d)()):(0,T.of)(null)))),(0,l.b)((e=>{this.clientList$=this.clientService.getAllClients(!1,!0),this.buildForm(),e&&(this.globalService.setCurrentItem({id:this.groupId,category:"client-group"}),this.updateForm(e))}))).subscribe()}ngOnDestroy(){this.groupId&&this.globalService.removeCurrentItem()}buildForm(){this.formGroup=this.formBuilder.group({id:[{value:null,disabled:!0}],name:["",u.kI.required],clients:this.formBuilder.array([])})}updateForm(e){this.formGroup.patchValue(e),e.clients.forEach((e=>this.addClient(e)))}addClient(e){const t=e||null;return(this.formGroup?.get("clients")).push(this.formBuilder.control(t,u.kI.required))}removeClient(e){(this.formGroup?.get("clients")).removeAt(e)}save(){return this.groupId?this.clientGroupService.updateClientGroup({...this.formGroup.value,id:this.groupId},this.groupId).subscribe():this.clientGroupService.createClientGroup(this.formGroup.value).pipe((0,l.b)((e=>this.router.navigateByUrl(`client-groups/client-group/${e.id}/edit`)))).subscribe()}discard(e){this.buildForm(),this.updateForm(e),this.toastrService.success("Changes have been discarded")}};ye=(0,r.gn)([(0,s.Component)({selector:"app-client-group-editor",templateUrl:"./client-group-editor.component.html",styleUrls:["./client-group-editor.component.scss"]})],ye);const fe=[{path:"",component:h,children:[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"dashboard",component:p},{path:"clients",component:K,children:[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"dashboard",component:Y},{path:"client",pathMatch:"full",redirectTo:"dashboard"},{path:"folder",pathMatch:"full",redirectTo:"dashboard"},{path:"folder/:id",component:re,data:{category:"client"}},{path:"client/new",component:J},{path:"client/:clientId",component:J},{path:"**",redirectTo:"dashboard"}]},{path:"schedules",component:se,children:[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"dashboard",component:ne},{path:"schedule",pathMatch:"full",redirectTo:"dashboard"},{path:"schedule/:clientId",component:ae},{path:"**",redirectTo:"dashboard"}]},{path:"master-schedules",component:ue},{path:"client-groups",component:me,children:[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"dashboard",component:be},{path:"client-group",pathMatch:"full",redirectTo:"dashboard"},{path:"group-schedule",pathMatch:"full",redirectTo:"dashboard"},{path:"client-group/new",component:ye},{path:"client-group/:id/edit",component:ye},{path:"client-group/:id",component:Ce},{path:"**",redirectTo:"dashboard"}]},{path:"users",component:N,children:[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"dashboard",component:R},{path:"user",pathMatch:"full",redirectTo:"dashboard"},{path:"user/new",component:Z},{path:"user/:id",component:Z},{path:"**",redirectTo:"dashboard"}]},{path:"player-versions",component:te,children:[{path:"",pathMatch:"full",redirectTo:"player-version/new"},{path:"player-version",pathMatch:"full",redirectTo:"player-version/new"},{path:"player-version/new",component:ie},{path:"player-version/:id",component:ie},{path:"**",redirectTo:"player-version/new"}]},{path:"link-previews",component:pe},{path:"link-previews/link-preview",pathMatch:"full",redirectTo:"link-previews"},{path:"link-previews/link-preview/new",component:de},{path:"link-previews/link-preview/:previewLinkId",component:de},{path:"**",redirectTo:"dashboard"}]}];let Se=class{};Se=(0,r.gn)([(0,s.NgModule)({declarations:[],imports:[n.ez,d.Bz.forChild(fe)],exports:[d.Bz]})],Se);var je=i(5307),we=i(6974);let Ie=class{constructor(){this.linkPreviews=[],this.editClicked=new s.EventEmitter,this.removeClicked=new s.EventEmitter,this.displayedColumns=["id","name","program","expires-at","settings"]}ngAfterViewInit(){this.dataSource=new we.by(this.linkPreviews),this.dataSource.paginator=this.paginator}ngOnChanges(e){e.linkPreviews.currentValue?.length&&(this.dataSource=new we.by(this.linkPreviews),this.dataSource.paginator=this.paginator)}goTo(e){window.location.href=`${c.N.previewPlayerUrl}/#${e.toLowerCase().replaceAll(" ","_")}`}edit(e){this.editClicked.emit(e)}remove(e){this.removeClicked.emit(e)}};(0,r.gn)([(0,s.ViewChild)(je.NW)],Ie.prototype,"paginator",void 0),(0,r.gn)([(0,s.Input)()],Ie.prototype,"linkPreviews",void 0),(0,r.gn)([(0,s.Output)()],Ie.prototype,"editClicked",void 0),(0,r.gn)([(0,s.Output)()],Ie.prototype,"removeClicked",void 0),Ie=(0,r.gn)([(0,s.Component)({selector:"app-link-preview-dashboard",templateUrl:"./link-preview-dashboard.component.html",styleUrls:["./link-preview-dashboard.component.scss"]})],Ie);const ke=[{name:"Daily",id:"DAY"},{name:"Weekly",id:"WEEK"},{name:"Monthly",id:"MONTH"}];let $e=class{constructor(){this.formBuilder=(0,s.inject)(u.qu),this.clientService=(0,s.inject)(F),this.scheduleService=(0,s.inject)(le),this.dialog=(0,s.inject)(m.uw),this.category="client",this.eventUpdated=new s.EventEmitter,this.eventRepeatingOptions=ke}ngOnInit(){this.programList$=this.clientService.getProgramList()}ngOnChanges(e){this.formGroup=null,e.eventId.currentValue?this.scheduleService.getEvent(e.eventId.currentValue,this.eventCategory).pipe((0,l.b)((e=>{this.event=e,this.buildForm(),e&&this.updateForm(e)}))).subscribe():this.buildForm()}buildForm(){this.formGroup=this.formBuilder.group({id:[{value:null,disabled:!0}],name:["",u.kI.required],content:[null,u.kI.required],start:[null,u.kI.required],end:[null,u.kI.required],repeating:[null],repeat_every_n:[null],repeating_end:[null],high_priority:[!1]})}updateForm(e){this.formGroup?.patchValue(e),this.formGroup?.get("start")?.setValue(new Date(e.start).toISOString().substring(0,16)),this.formGroup?.get("end")?.setValue(new Date(e.end).toISOString().substring(0,16)),e.repeating_end&&this.formGroup?.get("repeating_end")?.setValue(new Date(e.repeating_end).toISOString().substring(0,16)),this.formGroup?.get("content")?.setValue(e.content.object)}save(){const e={...this.formGroup?.value,id:this.eventId,content:{id:`pr${this.formGroup?.get("content")?.value?.id}`,object:this.formGroup?.get("content")?.value,type:"program"},repeating:this.formGroup?.get("repeating")?.value?this.formGroup?.get("repeating")?.value:"NO"};return"client"===this.category?e.client=this.id:e.group=this.id,this.eventId?this.scheduleService.updateEvent(this.eventId,this.eventCategory,e).subscribe((()=>this.eventUpdated.emit())):this.scheduleService.createEvent(this.eventCategory,e).subscribe((()=>this.eventUpdated.emit()))}discard(e){this.buildForm(),this.updateForm(e)}remove(e){this.dialog.open(b,{data:{message:"Are you sure you want to delete this event? This action is irreversible."}}).afterClosed().pipe((0,q.h)((e=>e)),(0,$.w)((()=>this.scheduleService.deleteEvent(e,this.eventCategory).pipe((0,l.b)((()=>this.eventUpdated.emit())))))).subscribe()}get eventCategory(){return"client"===this.category?"event":"group-event"}};(0,r.gn)([(0,s.Input)()],$e.prototype,"id",void 0),(0,r.gn)([(0,s.Input)()],$e.prototype,"category",void 0),(0,r.gn)([(0,s.Input)()],$e.prototype,"eventId",void 0),(0,r.gn)([(0,s.Output)()],$e.prototype,"eventUpdated",void 0),$e=(0,r.gn)([(0,s.Component)({selector:"app-event-editor",templateUrl:"./event-editor.component.html",styleUrls:["./event-editor.component.scss"]})],$e);let Ue=class{};Ue=(0,r.gn)([(0,s.NgModule)({declarations:[h,p,re,K,Y,J,N,R,Z,te,ie,se,ne,ae,pe,de,Ie,ue,me,be,$e,ye,Ce],imports:[n.ez,d.lC,H,a.hd,d.Od,d.rH,Se,n.Zd,u.UX,a.pC,H]})],Ue)}}]);